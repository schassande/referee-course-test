<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-button routerLink="/home" detail>
                <ion-icon name="arrow-back"></ion-icon>
            </ion-button>
        </ion-buttons>
        <ion-title style="text-align: center;" i18n="@@session-play.title">Sessions</ion-title>
        <ion-buttons slot="end">
            <ion-menu-button autoHide="false" menu="main"></ion-menu-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content (swipe)="onSwipe($event)">
    <ion-fab *ngIf="session" vertical="bottom" horizontal="end" slot="fixed">
        <ion-row>
            <ion-col *ngIf="isTeacher && (session.status === 'REGISTRATION' || session.status === 'STOPPED')">
                <ion-fab-button (click)="start()">
                    <ion-icon name="play-outline"></ion-icon>
                </ion-fab-button>
            </ion-col>
            <ion-col *ngIf="isTeacher && (session.status === 'STARTED')">
                <ion-fab-button (click)="stop()" style='--background:red; font-size: 1.6em; margin-bottom: 10px;'>
                    <ion-icon name="stop-outline"></ion-icon>
                </ion-fab-button>
            </ion-col>
            <ion-col *ngIf="isTeacher && session.status === 'STOPPED'">
                <ion-fab-button (click)="correction()" style='--background:yellow; font-size: 1.6em; margin-bottom: 10px;'>
                    <ion-icon name="checkmark-done-outline"></ion-icon>
                </ion-fab-button>
            </ion-col>
            <ion-col *ngIf="isTeacher && session.status === 'CORRECTION'">
                <ion-fab-button (click)="close()" style='--background:red; font-size: 1.6em; margin-bottom: 10px;'>
                    <ion-icon name="close-outline"></ion-icon>
                </ion-fab-button>
            </ion-col>
            <ion-col>
                <ion-fab-button (click)="loadData()" style='--background:green;'>
                    <ion-icon name="reload-outline"></ion-icon>
                </ion-fab-button>
            </ion-col>
        </ion-row>
    </ion-fab>
    <div *ngIf="loading" style="margin: 20px auto; text-align: center;">
        <ion-spinner name="bubbles"></ion-spinner>
    </div>

    <div *ngIf="!loading && session && session.status !== 'CLOSED'">
        <div class="questionNumberLine">
            <ion-button shape="round" (click)="decQuestionIdx()" class="questionButton" style="margin-left: 20px;">
                <ion-icon name="arrow-back-outline"></ion-icon>
            </ion-button>
            <div class="questionNumber"><span i18n="@@session-play.question">Question</span> {{questionIdx + 1}}/{{questions.length}}</div>
            <ion-button shape="round" (click)="incQuestionIdx()" class="questionButton">
                <ion-icon name="arrow-forward-outline"></ion-icon>
            </ion-button>
        </div>
        <div style="clear: both;"></div>
        <ion-list>
            <ion-item>
                <ion-label innerHtml="{{question.text}}" class="question"></ion-label>
            </ion-item>
            <ion-radio-group name="question" [(ngModel)]="answerValue">
                <ion-item *ngFor="let answer of question.answers; let index = index;" (click)="answerSelected(index)" [ngClass]="{'rightAnswer': showRightAnswer && answer.right}">
                    <ion-label class="answer">{{answerLetters[index]}} - {{answer.text}}</ion-label>
                    <ion-icon *ngIf="sessionExpired && answerValue && answerValue === index.toString()" slot="end" name="radio-button-on-outline"></ion-icon>
                    <ion-radio *ngIf="!sessionExpired" slot="end" value="{{index}}"></ion-radio>
                </ion-item>
            </ion-radio-group>
        </ion-list>
        <div class="questionNumberLine">
            <div class="questionNumber" *ngIf="session.status === 'CORRECTION'" [ngClass]="{'testPass': participantResult.pass, 'testFail': !participantResult.pass}">
                <span i18n="@@session-play.score">Score</span>: {{participantResult.score}}/{{participantResult.requiredScore}}, {{participantResult.percent}}%
            </div>
            <div class="questionNumber"><span i18n="@@session-play.question-no-answer">Questions without answer</span>: {{nbQuestion - learnerAnswers.size}}/{{nbQuestion}}
                <ion-button shape="round" (click)="nextNoAnswerQuestion()" class="questionButton" *ngIf="nbQuestion > learnerAnswers.size">
                    <ion-icon name="search-outline"></ion-icon>
                </ion-button>
            </div>
            <div class="questionNumber" *ngIf="session.autoPlay">
                <ion-button shape="round" (click)="autoClose()" class="questionButton" i18n="@@session-play.button-close">Close the exam (cannot undo)</ion-button>
            </div>
            <div class="questionNumber">
                <span *ngIf="sessionExpired" class="expired"><span i18n="@@session-play.session-expired">Session expired</span> ({{dateService.datetime2string(session.expireDate)}})</span>
                <span *ngIf="!sessionExpired" class="notExpired"><span i18n="@@session-play.remaining-time">Remaining time</span>: {{remainingTime}}</span>
            </div>
            <div>
                <span i18n="@@session-play.available-languages">Available languages</span>: <br><span *ngFor="let lg of course.test.supportedLanguages" [ngClass]="{ 'selectedLang': lg === lang}" style="margin: 0 10px;">
                     <img src="assets/flags/{{lg.toUpperCase()}}.png" height="30px" (click)="changeLanguage(lg)" style="margin-top: 10px;">
                </span>
            </div>
        </div>
    </div>
</ion-content>